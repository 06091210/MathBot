<!--<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>二次方程式ソルバー</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 2em auto;
      padding: 1em;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    input {
      width: 60px;
      margin-right: 10px;
    }
    #result {
      margin-top: 1em;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h2>二次方程式ソルバー</h2>
  <p>方程式：<code>ax² + bx + c = 0</code></p>
  <form onsubmit="solve(); return false;">
    a: <input type="number" id="a" value="1" step="any">
    b: <input type="number" id="b" value="0" step="any">
    c: <input type="number" id="c" value="1" step="any">
    <button type="submit">解を求める</button>
  </form>

  <div id="result"></div>

  <script>
    function gcd(a, b) {
      if (!b) return a;
      return gcd(b, a % b);
    }

    function simplifyFraction(numerator, denominator) {
      const sign = Math.sign(numerator) * Math.sign(denominator);
      numerator = Math.abs(numerator);
      denominator = Math.abs(denominator);
      const d = gcd(numerator, denominator);
      return {
        numerator: sign * (numerator / d),
        denominator: denominator / d,
      };
    }

    function fractionToString(frac) {
      if (frac.denominator === 1) return `${frac.numerator}`;
      return `${frac.numerator}/${frac.denominator}`;
    }

    function sqrtSimplify(n) {
      let outside = 1;
      let inside = n;
      for (let i = 2; i * i <= inside; i++) {
        while (inside % (i * i) === 0) {
          inside /= i * i;
          outside *= i;
        }
      }
      return { outside, inside };
    }

    function formatComplex(realStr, imagStr, sign) {
      const realZero = realStr === '0';
      const imagZero = imagStr === '0';

      if (realZero && imagZero) return '0';
      if (realZero) return `${sign === '-' ? '-' : ''}${imagStr}`;
      if (imagZero) return realStr;
      return `${realStr} ${sign} ${imagStr}`;
    }

    function solveQuadratic(a, b, c) {
      if (a === 0) {
        return b === 0
          ? (c === 0 ? '無限に解があります。' : '解が存在しません。')
          : `1次方程式の解: x = ${-c / b}`;
      }

      const discriminant = b * b - 4 * a * c;
      const denominator = 2 * a;

      if (discriminant > 0) {
        const sqrtInfo = sqrtSimplify(discriminant);
        if (sqrtInfo.inside === 1) {
          const root1 = simplifyFraction(-b + sqrtInfo.outside, denominator);
          const root2 = simplifyFraction(-b - sqrtInfo.outside, denominator);
          return `解: x₁ = ${fractionToString(root1)}, x₂ = ${fractionToString(root2)}`;
        } else {
          const real = simplifyFraction(-b, denominator);
          const imag = simplifyFraction(sqrtInfo.outside, denominator);
          const sqrt = sqrtInfo.inside;

          const realStr = fractionToString(real);
          const imagStr = imag.numerator === 1 && imag.denominator === 1
            ? `√${sqrt}`
            : `${fractionToString(imag)}√${sqrt}`;

          return `解: x₁ = ${formatComplex(realStr, imagStr, '+')}, x₂ = ${formatComplex(realStr, imagStr, '-')}`;
        }
      } else if (discriminant === 0) {
        const root = simplifyFraction(-b, denominator);
        return `重解: x = ${fractionToString(root)}`;
      } else {
        const absD = -discriminant;
        const sqrtInfo = sqrtSimplify(absD);
        const real = simplifyFraction(-b, denominator);
        const imag = simplifyFraction(sqrtInfo.outside, denominator);
        const sqrt = sqrtInfo.inside;

        const realStr = fractionToString(real);
        let imagStr;
        if (imag.numerator === 1 && imag.denominator === 1) {
          imagStr = sqrt === 1 ? `i` : `i√${sqrt}`;
        } else {
          imagStr = sqrt === 1
            ? `${fractionToString(imag)}i`
            : `${fractionToString(imag)}i√${sqrt}`;
        }

        return `虚数解: x₁ = ${formatComplex(realStr, imagStr, '+')}, x₂ = ${formatComplex(realStr, imagStr, '-')}`;
      }
    }

    function solve() {
      const a = parseFloat(document.getElementById('a').value);
      const b = parseFloat(document.getElementById('b').value);
      const c = parseFloat(document.getElementById('c').value);

      const result = solveQuadratic(a, b, c);
      document.getElementById('result').textContent = result;
    }
  </script>

</body>
</html>-->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>√付き分母有理化 二次方程式ソルバー</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.js"></script>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2em auto; padding: 1em; border: 1px solid #ccc; border-radius: 8px; }
    input { width: 150px; margin: 5px; }
    #result { margin-top: 1em; font-weight: bold; white-space: pre-line; }
  </style>
</head>
<body>

  <h2>√付き・分母有理化対応 二次方程式ソルバー</h2>
  <p>ax² + bx + c = 0 の係数に sqrt(), pi, i, 複素数など可</p>

  <form onsubmit="solve(); return false;">
    a: <input type="text" id="a" value="1"><br>
    b: <input type="text" id="b" value="2"><br>
    c: <input type="text" id="c" value="5"><br>
    <button type="submit">解を求める</button>
  </form>

  <div id="result"></div>

<script>
function fmtSqrtFrac(numer, denom) {
  // √の因数を外に出し、約分
  let sq = math.sqrt(numer);
  if (math.isInteger(sq)) {
    return `${sq}/${denom}`;
  }
  let outside = 1, inside = numer;
  for (let i = 2; i*i <= inside; i++) {
    while (inside % (i*i) === 0) {
      inside /= (i*i);
      outside *= i;
    }
  }
  let gcd = math.gcd(outside, denom);
  outside /= gcd;
  let d2 = denom / gcd;
  const numStr = outside === 1 ? '' : outside;
  const sqrtStr = `√${inside}`;
  if (d2 === 1) return `${numStr}${sqrtStr}`;
  return `${numStr}${sqrtStr}/${d2}`;
}

function formatExpr(expr) {
  // expr = math.simplify(expr)
  if (expr.im === 0) return expr.re.toString();
  if (expr.re === 0) {
    let im = expr.im, sign = im < 0 ? '-' : '';
    let abs = math.abs(im);
    if (math.isInteger(abs)) {
      return `${sign}${abs === 1 ? '' : abs}i`;
    }
  }
  let re = expr.re, im = expr.im;
  let reStr = re.toString();
  let imSign = im < 0 ? '-' : '+';
  let abs = math.abs(im);
  let imStr = math.isInteger(abs) ? `${abs === 1 ? '' : abs}i` : `${abs}i`;
  return `${reStr} ${imSign} ${imStr}`;
}

function solve() {
  const res = document.getElementById('result');
  res.textContent = '';
  try {
    const a = math.evaluate(document.getElementById('a').value);
    const b = math.evaluate(document.getElementById('b').value);
    const c = math.evaluate(document.getElementById('c').value);

    if (math.equal(a, 0)) return res.textContent = 'a = 0 のため一次方程式になります';

    const D = math.simplify(math.subtract(math.square(b), math.multiply(4,a,c)));
    const sqrtD = math.simplify(math.sqrt(D));
    const denom = math.multiply(2, a);

    const x1 = math.simplify(math.divide(math.add(math.unaryMinus(b), sqrtD), denom));
    const x2 = math.simplify(math.divide(math.subtract(math.unaryMinus(b), sqrtD), denom));

    // 分母有理化: 判別式が正かつ sqrtDに根を含む
    let out = `D = ${math.format(D)}\n`;

    // √付き分母有理化形式
    if (math.isPositive(D) && !math.isInteger(math.sqrt(D))) {
      // real parts: (-b)/(2a)
      let realPart = math.simplify(math.divide(math.unaryMinus(b), denom));
      // imag part: sqrt(D)/(2a)
      let numD = math.number(math.squeeze(D));
      let denomNum = math.number( math.multiply(2, a) );
      let frac = fmtSqrtFrac(numD, denomNum);
      out += `解: x₁ = ${realPart.toString()} + ${frac}, x₂ = ${realPart.toString()} - ${frac}`;
    } else {
      // 通常表示へ
      const cx1 = math.complex(x1);
      const cx2 = math.complex(x2);
      out += `解: x₁ = ${formatExpr(cx1)}, x₂ = ${formatExpr(cx2)}`;
    }
    res.textContent = out;
  } catch (e) {
    res.textContent = '入力を確認してください';
    console.error(e);
  }
}
</script>
</body>
</html>

