<!--<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>二次方程式ソルバー</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 2em auto;
      padding: 1em;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    input {
      width: 60px;
      margin-right: 10px;
    }
    #result {
      margin-top: 1em;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h2>二次方程式ソルバー</h2>
  <p>方程式：<code>ax² + bx + c = 0</code></p>
  <form onsubmit="solve(); return false;">
    a: <input type="number" id="a" value="1" step="any">
    b: <input type="number" id="b" value="0" step="any">
    c: <input type="number" id="c" value="1" step="any">
    <button type="submit">解を求める</button>
  </form>

  <div id="result"></div>

  <script>
    function gcd(a, b) {
      if (!b) return a;
      return gcd(b, a % b);
    }

    function simplifyFraction(numerator, denominator) {
      const sign = Math.sign(numerator) * Math.sign(denominator);
      numerator = Math.abs(numerator);
      denominator = Math.abs(denominator);
      const d = gcd(numerator, denominator);
      return {
        numerator: sign * (numerator / d),
        denominator: denominator / d,
      };
    }

    function fractionToString(frac) {
      if (frac.denominator === 1) return `${frac.numerator}`;
      return `${frac.numerator}/${frac.denominator}`;
    }

    function sqrtSimplify(n) {
      let outside = 1;
      let inside = n;
      for (let i = 2; i * i <= inside; i++) {
        while (inside % (i * i) === 0) {
          inside /= i * i;
          outside *= i;
        }
      }
      return { outside, inside };
    }

    function formatComplex(realStr, imagStr, sign) {
      const realZero = realStr === '0';
      const imagZero = imagStr === '0';

      if (realZero && imagZero) return '0';
      if (realZero) return `${sign === '-' ? '-' : ''}${imagStr}`;
      if (imagZero) return realStr;
      return `${realStr} ${sign} ${imagStr}`;
    }

    function solveQuadratic(a, b, c) {
      if (a === 0) {
        return b === 0
          ? (c === 0 ? '無限に解があります。' : '解が存在しません。')
          : `1次方程式の解: x = ${-c / b}`;
      }

      const discriminant = b * b - 4 * a * c;
      const denominator = 2 * a;

      if (discriminant > 0) {
        const sqrtInfo = sqrtSimplify(discriminant);
        if (sqrtInfo.inside === 1) {
          const root1 = simplifyFraction(-b + sqrtInfo.outside, denominator);
          const root2 = simplifyFraction(-b - sqrtInfo.outside, denominator);
          return `解: x₁ = ${fractionToString(root1)}, x₂ = ${fractionToString(root2)}`;
        } else {
          const real = simplifyFraction(-b, denominator);
          const imag = simplifyFraction(sqrtInfo.outside, denominator);
          const sqrt = sqrtInfo.inside;

          const realStr = fractionToString(real);
          const imagStr = imag.numerator === 1 && imag.denominator === 1
            ? `√${sqrt}`
            : `${fractionToString(imag)}√${sqrt}`;

          return `解: x₁ = ${formatComplex(realStr, imagStr, '+')}, x₂ = ${formatComplex(realStr, imagStr, '-')}`;
        }
      } else if (discriminant === 0) {
        const root = simplifyFraction(-b, denominator);
        return `重解: x = ${fractionToString(root)}`;
      } else {
        const absD = -discriminant;
        const sqrtInfo = sqrtSimplify(absD);
        const real = simplifyFraction(-b, denominator);
        const imag = simplifyFraction(sqrtInfo.outside, denominator);
        const sqrt = sqrtInfo.inside;

        const realStr = fractionToString(real);
        let imagStr;
        if (imag.numerator === 1 && imag.denominator === 1) {
          imagStr = sqrt === 1 ? `i` : `i√${sqrt}`;
        } else {
          imagStr = sqrt === 1
            ? `${fractionToString(imag)}i`
            : `${fractionToString(imag)}i√${sqrt}`;
        }

        return `虚数解: x₁ = ${formatComplex(realStr, imagStr, '+')}, x₂ = ${formatComplex(realStr, imagStr, '-')}`;
      }
    }

    function solve() {
      const a = parseFloat(document.getElementById('a').value);
      const b = parseFloat(document.getElementById('b').value);
      const c = parseFloat(document.getElementById('c').value);

      const result = solveQuadratic(a, b, c);
      document.getElementById('result').textContent = result;
    }
  </script>

</body>
</html>-->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>複素係数三次方程式ソルバー（整形表示付き）</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.js"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: 2em auto; }
    input { width: 200px; margin: 0.5em 0; }
    #result { margin-top: 1em; }
  </style>
</head>
<body>
  <h2>複素係数三次方程式ソルバー（整形表示付き）</h2>
  <p><code>ax^3 + bx^2 + cx + d = 0</code> の係数を入力してください（√, π, i などもOK）</p>
  <form onsubmit="solve(); return false;">
    a: <input type="text" id="a" value="1"><br>
    b: <input type="text" id="b" value="0"><br>
    c: <input type="text" id="c" value="0"><br>
    d: <input type="text" id="d" value="-1"><br>
    <button type="submit">解を求める</button>
  </form>
  <div id="result"></div>

<script>
function parse(expr) {
  try {
    return math.evaluate(expr);
  } catch (e) {
    return null;
  }
}

function formatComplex(z) {
  const re = math.simplify(math.re(z));
  const im = math.simplify(math.im(z));
  let reStr = re.toString() === '0' ? '' : math.format(re, { fraction: 'ratio' });
  let imStr = '';
  if (!math.equal(im, 0)) {
    const absIm = math.abs(im);
    const imVal = math.format(absIm, { fraction: 'ratio' });
    imStr = (math.smaller(im, 0) ? ' - ' : (reStr ? ' + ' : '')) + (imVal === '1' ? 'i' : imVal + 'i');
  }
  return reStr + imStr || '0';
}

function solve() {
  const a = parse(document.getElementById("a").value);
  const b = parse(document.getElementById("b").value);
  const c = parse(document.getElementById("c").value);
  const d = parse(document.getElementById("d").value);
  const result = document.getElementById("result");

  if (!a || !b || !c || !d || math.equal(a, 0)) {
    result.innerHTML = "<span style='color:red'>入力に誤りがあります</span>";
    return;
  }

  // カルダノの公式を使って三次方程式 ax^3 + bx^2 + cx + d = 0 を解く
  const one = math.complex(1);
  const zero = math.complex(0);
  const C3 = math.divide(b, a);
  const C2 = math.divide(c, a);
  const C1 = math.divide(d, a);

  const p = math.subtract(C2, math.divide(math.square(C3), 3));
  const q = math.add(
    math.multiply(2, math.pow(C3, 3)) / 27,
    math.subtract(
      math.multiply(-1, math.divide(C3, 3), C2),
      C1
    )
  );

  const D = math.divide(math.add(math.square(q), math.multiply(4, math.pow(p, 3)) / 27), 4);

  const sqrtD = math.sqrt(D);
  const u = math.cbrt(math.divide(-q, 2) + sqrtD);
  const v = math.cbrt(math.divide(-q, 2) - sqrtD);
  const omega = math.complex(-0.5, Math.sqrt(3) / 2);

  const x1 = math.subtract(math.add(u, v), math.divide(C3, 3));
  const x2 = math.subtract(math.add(math.multiply(omega, u), math.multiply(math.conj(omega), v)), math.divide(C3, 3));
  const x3 = math.subtract(math.add(math.multiply(math.conj(omega), u), math.multiply(omega, v)), math.divide(C3, 3));

  const out = `
    \[
    x_1 = ${formatComplex(x1)} \\
    x_2 = ${formatComplex(x2)} \\
    x_3 = ${formatComplex(x3)}
    \]`;

  result.innerHTML = out;
  MathJax.typesetPromise();
}
</script>
</body>
</html>
